<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PathPilot.Desktop.Controls"
        x:Class="PathPilot.Desktop.TreeViewerWindow"
        Title="Passive Skill Tree"
        Width="1200" Height="900"
        Background="#0c0b0a">

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Border Grid.Row="0" Background="#1a1816" Padding="15,10"
                BorderBrush="#33c8aa6e" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                    <TextBlock Name="TreeTitleText"
                               Text="Passive Skill Tree"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#c8aa6e"
                               VerticalAlignment="Center"/>
                    <ComboBox Name="TreeSetSelector"
                              IsVisible="False"
                              Background="#2a2520"
                              Foreground="#e0d6c2"
                              FontSize="13"
                              MinWidth="150"
                              VerticalAlignment="Center"
                              SelectionChanged="TreeSetSelector_SelectionChanged"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                            HorizontalAlignment="Right" VerticalAlignment="Center" Margin="15,0">
                    <TextBox Name="SearchBox" Watermark="Search nodes..."
                             Width="220" Background="#2a2520" Foreground="#e0d6c2"
                             BorderBrush="#5a4f3d" FontSize="13" VerticalAlignment="Center"
                             TextChanged="SearchBox_TextChanged" KeyDown="SearchBox_KeyDown"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                    <Button Name="ZoomOutButton"
                            Content="&#x2212;"
                            Click="ZoomOutButton_Click"
                            Background="#2a2520"
                            Foreground="#e0d6c2"
                            BorderBrush="#5a4f3d"
                            Padding="12,6"
                            FontSize="18"
                            FontWeight="Bold"
                            CornerRadius="5"/>
                    <TextBlock Name="ZoomLevelText"
                               Text="100%"
                               Foreground="#a89b8c"
                               VerticalAlignment="Center"
                               Width="50"
                               TextAlignment="Center"/>
                    <Button Name="ZoomInButton"
                            Content="+"
                            Click="ZoomInButton_Click"
                            Background="#2a2520"
                            Foreground="#e0d6c2"
                            BorderBrush="#5a4f3d"
                            Padding="12,6"
                            FontSize="18"
                            FontWeight="Bold"
                            CornerRadius="5"/>
                    <Button Name="Zoom26Button"
                            Content="26%"
                            Click="Zoom26Button_Click"
                            Background="#3d3520"
                            Foreground="#c8aa6e"
                            BorderBrush="#5a4f3d"
                            Padding="12,6"
                            FontSize="12"
                            CornerRadius="5"
                            ToolTip.Tip="Set zoom to 26% (useful default)"/>
                    <Button Name="RefreshButton"
                            Content="Reload Tree"
                            Click="RefreshButton_Click"
                            Background="#2a2520"
                            Foreground="#e0d6c2"
                            BorderBrush="#5a4f3d"
                            Padding="12,6"
                            CornerRadius="5"/>
                </StackPanel>
            </Grid>
        </Border>

        <Popup Name="SearchPopup" PlacementTarget="{Binding #SearchBox}"
               Placement="Bottom" IsLightDismissEnabled="True" MaxHeight="300"
               Grid.Row="0">
            <Border Background="#1a1816" BorderBrush="#5a4f3d" BorderThickness="1" CornerRadius="4">
                <ListBox Name="SearchResultsList" Background="Transparent"
                         Foreground="#e0d6c2" MaxHeight="290"
                         SelectionChanged="SearchResultsList_SelectionChanged"/>
            </Border>
        </Popup>

        <!-- Native Tree Canvas -->
        <Border Grid.Row="1" Background="#0a0908" ClipToBounds="True">
            <local:SkillTreeCanvas Name="TreeCanvas"
                                   Background="Transparent"
                                   HorizontalAlignment="Stretch"
                                   VerticalAlignment="Stretch" />
        </Border>
    </Grid>
</Window>